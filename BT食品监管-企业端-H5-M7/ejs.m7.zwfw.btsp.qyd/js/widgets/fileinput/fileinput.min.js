!function(){"use strict";var t={type:"ALL",isMulti:!1,container:""};function d(e,n,r,t,o){if("DataUrl"===o){var i=new Image;return i.src=(a=n,(l=null)!=window.createObjectURL?l=window.createObjectURL(a):null!=window.URL?l=window.URL.createObjectURL(a):null!=window.webkitURL&&(l=window.webkitURL.createObjectURL(a)),l),i.onload=function(){r&&r(function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);var i=e.src.substring(e.src.lastIndexOf(".")+1).toLowerCase();return t.toDataURL("image/"+i)}(i))},void(i.onerror=function(e){t&&t(e)})}if(window.FileReader||!e||!(e instanceof FileReader))return e.onload=function(e){var t,i,a=e.target.result;"DataUrl"===o&&a&&-1!==a.indexOf("data:base64,")&&(a=a.replace("data:base64,",""),t="",(i=n.name)&&-1!==i.toLowerCase().indexOf(".jpg")?t="image/jpeg":i&&-1!==i.toLowerCase().indexOf(".png")?t="image/png":i&&-1!==i.toLowerCase().indexOf(".gif")?t="image/gif":i&&-1!==i.toLowerCase().indexOf(".icon")&&(t="image/x-icon"),a="data:"+t+";base64,"+a),r&&r(a)},e.onerror=function(e){e&&e(e)},"DataUrl"===o?e.readAsDataURL(n):"Text"===o?e.readAsText(n):e.readAsBinaryString(n),e;var a,l;t&&t("错误:FileReader不存在!")}function e(e){e=Util.extend({},t,e),this.container=Util.selector(e.container),this.options=e,this._init(),this._addEvent()}e.prototype={_init:function(){var e=Util.os.ejs,t=this.options,i=this.container;i.setAttribute("type","file"),t.isMulti?i.setAttribute("multiple","multiple"):i.removeAttribute("multiple");var a,n=t.accept||i.getAttribute("accept"),r=t.type||"File",o=Util.os.android,r="Image"===r?(a="image/*","DataUrl"):"Camera"===r?(a=e&&o?"camera/*":"image/*","DataUrl"):"Image_Camera"===r?(a=e&&o?"image_camera/*":"image/*","DataUrl"):"Image_File"===r?(a=e&&o?"image_file/*":"*","DataUrl"):"Camera_File"===r?(a=e&&o?"camera_file/*":"*","DataUrl"):"Text"===r?(a=e&&o?"text/*":"file/*","Text"):"File"===r?e&&o?(a="file/*","DataUrl"):(a="*","File"):"All"===r?(a=e&&o?"*/*":"*","DataUrl"):(a="*","File");this.dataType=r,a=n||a,i.setAttribute("accept",a)},_addEvent:function(){function e(e){var t,i,a,n=o.files,r=n.length;0!==r&&(t=new window.FileReader,i=0,(a=function(){r<=i||d(t,n[i],function(e){l&&l(e,n[i],{index:i,len:r,isEnd:r-1<=i}),i++,a()},s,c.dataType)})())}var o=this.container,t=this.options,l=t.success,s=t.error,c=this;o.addEventListener("change",e),this.delegatesHandle=e},destroy:function(){this.container.removeEventListener("change",this.delegatesHandle),this.container=null,this.options=null}},window.FileInput=e}();