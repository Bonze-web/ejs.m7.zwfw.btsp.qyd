!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):t.imageScale=i()}(window.Util,function(){"use strict";function e(t,i){return function(f,c,v,t,u,i){for(var g=u/c,m=i/v,l=t,a=0;a<u;a+=1)for(var e=0;e<i;e+=1)!function(t,i){var a=Math.min(c-1,t/g),e=Math.min(v-1,i/m),r=Math.floor(a),o=Math.floor(e),n=i*u+t,h=o*c+r;n*=4,h*=4;for(var d=0;d<=3;d+=1)l[n+d]=f[h+d]}(a,e)}(t.data,t.width,t.height,i.data,i.width,i.height),i}function k(t,i,a,e,r){var o=e,n=r;a<=o?o=a-1:o<0&&(o=0),i<=n?n=i-1:n<0&&(n=0);var h=o*i+n;return[t[0+(h*=4)],t[1+h],t[2+h],t[3+h]]}function r(t,i){return function(M,p,x,t,R,i){for(var S=R/p,y=i/x,I=t,a=0;a<R;a+=1)for(var e=0;e<i;e+=1)!function(t,i){var a=Math.min(p-1,t/S),e=Math.min(x-1,i/y),r=Math.floor(a),o=Math.floor(e),n=a-r,h=e-o,d=1-n,f=1-h,c=i*R+t;c*=4;for(var v=k(M,p,x,o+0,r+0),u=k(M,p,x,o+0,r+1),g=k(M,p,x,o+1,r+0),m=k(M,p,x,o+1,r+1),l=0;l<=3;l+=1){var s=h*(d*g[l]+n*m[l]),w=f*(d*v[l]+n*u[l]);I[c+l]=s+w}}(a,e)}(t.data,t.width,t.height,i.data,i.width,i.height),i}var o=void 0,n=void 0,h=void 0,d=void 0,f=void 0,c=void 0,v=void 0,u=void 0,g=void 0,m=void 0,l=void 0,s=void 0,w=void 0,M=void 0,p=void 0,x=void 0,R=function(t,i,a,e,r,o){var n=e,h=r;a<=n?n=a-1:n<0&&(n=0),i<=h?h=i-1:h<0&&(h=0);var d=n*i+h;return t[(d*=4)+o]},S=function(t){var i=t,i=Math.min(255,i);return i=Math.max(0,i)},y=function(t){o=t[1][1],n=-.5*t[1][0]+.5*t[1][2],h=t[1][0]-2.5*t[1][1]+2*t[1][2]-.5*t[1][3],d=-.5*t[1][0]+1.5*t[1][1]-1.5*t[1][2]+.5*t[1][3],f=-.5*t[0][1]+.5*t[2][1],c=.25*t[0][0]-.25*t[0][2]-.25*t[2][0]+.25*t[2][2],v=-.5*t[0][0]+1.25*t[0][1]-t[0][2]+.25*t[0][3]+.5*t[2][0]-1.25*t[2][1]+t[2][2]-.25*t[2][3],u=.25*t[0][0]-.75*t[0][1]+.75*t[0][2]-.25*t[0][3]-.25*t[2][0]+.75*t[2][1]-.75*t[2][2]+.25*t[2][3],g=t[0][1]-2.5*t[1][1]+2*t[2][1]-.5*t[3][1],m=-.5*t[0][0]+.5*t[0][2]+1.25*t[1][0]-1.25*t[1][2]-t[2][0]+t[2][2]+.25*t[3][0]-.25*t[3][2],l=t[0][0]-2.5*t[0][1]+2*t[0][2]-.5*t[0][3]-2.5*t[1][0]+6.25*t[1][1]-5*t[1][2]+1.25*t[1][3]+2*t[2][0]-5*t[2][1]+4*t[2][2]-t[2][3]-.5*t[3][0]+1.25*t[3][1]-t[3][2]+.25*t[3][3],s=-.5*t[0][0]+1.5*t[0][1]-1.5*t[0][2]+.5*t[0][3]+1.25*t[1][0]-3.75*t[1][1]+3.75*t[1][2]-1.25*t[1][3]-t[2][0]+3*t[2][1]-3*t[2][2]+t[2][3]+.25*t[3][0]-.75*t[3][1]+.75*t[3][2]-.25*t[3][3],w=-.5*t[0][1]+1.5*t[1][1]-1.5*t[2][1]+.5*t[3][1],M=.25*t[0][0]-.25*t[0][2]-.75*t[1][0]+.75*t[1][2]+.75*t[2][0]-.75*t[2][2]-.25*t[3][0]+.25*t[3][2],p=-.5*t[0][0]+1.25*t[0][1]-t[0][2]+.25*t[0][3]+1.5*t[1][0]-3.75*t[1][1]+3*t[1][2]-.75*t[1][3]-1.5*t[2][0]+3.75*t[2][1]-3*t[2][2]+.75*t[2][3]+.5*t[3][0]-1.25*t[3][1]+t[3][2]-.25*t[3][3],x=.25*t[0][0]-.75*t[0][1]+.75*t[0][2]-.25*t[0][3]-.75*t[1][0]+2.25*t[1][1]-2.25*t[1][2]+.75*t[1][3]+.75*t[2][0]-2.25*t[2][1]+2.25*t[2][2]-.75*t[2][3]-.25*t[3][0]+.75*t[3][1]-.75*t[3][2]+.25*t[3][3]},I=function(t,i){var a=t*t,e=i*i,r=e*i;return o+n*i+h*e+d*r+(f+c*i+v*e+u*r)*t+(g+m*i+l*e+s*r)*a+(w+M*i+p*e+x*r)*(a*t)};function P(t,i){return function(g,m,l,t,s,i){for(var w=t,M=s/m,p=i/l,a=0;a<s;a+=1)for(var e=0;e<i;e+=1)!function(t,i){var a=Math.min(m-1,t/M),e=Math.min(l-1,i/p),r=Math.floor(a),o=Math.floor(e),n=a-r,h=e-o,d=i*s+t;d*=4;for(var f=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],c=0;c<=3;c+=1){for(var v=-1;v<=2;v+=1)for(var u=-1;u<=2;u+=1)f[v+1][u+1]=R(g,m,l,o+v,r+u,c);y(f),w[d+c]=S(I(h,n))}}(a,e)}(t.data,t.width,t.height,i.data,i.width,i.height),i}var D=-1;function b(t){var i=0<=t?t:-t,a=t*t,e=i*a;return i<=1?1-(D+3)*a+(D+2)*e:i<=2?-4*D+8*D*i-5*D*a+D*e:0}function U(t){var i=t,i=Math.min(255,i);return i=Math.max(0,i)}function a(m,l,s,t,w,i){for(var M=t,p=w/l,x=i/s,a=0;a<w;a+=1)for(var e=0;e<i;e+=1)!function(t,i){var a=Math.min(l-1,t/p),e=Math.min(s-1,i/x),r=Math.floor(a),o=Math.floor(e),n=a-r,h=e-o,d=i*w+t;d*=4;for(var f=[0,0,0,0],c=-1;c<=2;c+=1)for(var v=-1;v<=2;v+=1){var u=function(t,i,a,e,r){var o=e,n=r;a<=o?o=a-1:o<0&&(o=0),i<=n?n=i-1:n<0&&(n=0);var h=o*i+n;return[t[0+(h*=4)],t[1+h],t[2+h],t[3+h]]}(m,l,s,o+c,r+v),g=b(c-h)*b(v-n);f[0]+=u[0]*g,f[1]+=u[1]*g,f[2]+=u[2]*g,f[3]+=u[3]*g}M[0+d]=U(f[0]),M[1+d]=U(f[1]),M[2+d]=U(f[2]),M[3+d]=U(f[3])}(a,e)}function W(t,i){return a(t.data,t.width,t.height,i.data,i.width,i.height),i}function B(t){for(var a=t,i=arguments.length,e=Array(1<i?i-1:0),r=1;r<i;r++)e[r-1]=arguments[r];return e.forEach(function(i){i&&Object.keys(i).forEach(function(t){a[t]=i[t]})}),a}var E={width:80,height:80,mime:"image/png",processType:1},O={quality:.92,mime:"image/jpeg",compressScaleRatio:1,iphoneFixedRatio:1.5,isUseOriginSize:!1,maxWidth:0,forceWidth:0,forceHeight:0};var j,t={};return(j=t).scaleImageData=function(t,i,a){(0,[e,r,P,W][B({},E,a).processType])(t,i)},j.scaleImage=function(t,i){var a=t.width,e=t.height,r=B({},E,i),o=document.createElement("canvas"),n=o.getContext("2d");o.width=a,o.height=e,n.drawImage(t,0,0,a,e);var h=n.getImageData(0,0,a,e),d=n.createImageData(r.width,r.height);return j.scaleImageData(h,d,r),o.width=d.width,o.height=d.height,n.putImageData(d,0,0,0,0,o.width,o.height),o.toDataURL(r.mime,.9)},j.compressImage=function(t,i){var a,e,r=t.width,o=t.height,n=r/o,h=B({},O,i),d=document.createElement("canvas"),f=d.getContext("2d"),c=(e=(a=f).backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1,(window.devicePixelRatio||1)/e);c*=h.compressScaleRatio||1,navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)&&(c*=h.iphoneFixedRatio||1);var v=window.innerWidth*c;(h.isUseOriginSize||r<v)&&(v=r);var u=h.maxWidth;u&&u<r&&u<v&&(v=u);var g=h.forceWidth,m=h.forceHeight;g&&(v=g);var l=m?m:v/n;return d.width=v,d.height=l,f.drawImage(t,0,0,r,o,0,0,d.width,d.height),d.toDataURL(h.mime,h.quality)},t});