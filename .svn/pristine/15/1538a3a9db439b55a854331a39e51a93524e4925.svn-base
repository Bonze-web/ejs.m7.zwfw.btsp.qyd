"use strict";Util.loadJs(["pages/common/common.js","pages/common/preview.js","pages/common/util.string_extend.js","pages/common/tabView.js","js/widgets/minirefresh/minirefresh.css","js/widgets/minirefresh/minirefresh.js"],"js/widgets/minirefresh/minirefresh.bizlogic.js",function(){customBiz.configReady()});var customBiz={configReady:function(){var e=this;Config.configReady(null,function(){customBiz.initListeners(),e.newest=new customBiz.InitPullRefreshList("newest"),e.news=new customBiz.InitPullRefreshList("news"),e.link=new customBiz.InitPullRefreshList("link"),e.att=new customBiz.InitPullRefreshList("att")},function(e){})},initListeners:function(){var e=this;setTimeout(function(){document.querySelector(".em-nav-item").classList.add("em-nav-item-Curr")},500),mui(".em-nav").on("tap","a",function(){var e=this.parentNode;e.querySelector(".em-nav-item-Curr").classList.remove("em-nav-item-Curr"),this.classList.add("em-nav-item-Curr")}),mui.init({gestureConfig:{doubletap:!0}}),document.querySelector(".em-nav").addEventListener("doubletap",function(){e.newest.instance.triggerDownLoading("noAnim"),e.news.instance.triggerDownLoading("noAnim"),e.link.instance.triggerDownLoading("noAnim"),e.att.instance.triggerDownLoading("noAnim")}),Config.customize.pageSearch?ejs.navigator.setRightBtn({which:0,text:"搜索",imageUrl:"../common/img/default/img_search_nav_btn.png",success:function(e){var t=Util.getExtraDataByKey("categoryguid")||"";ejs.page.open({pageUrl:"./notice_list_search.html",data:{categoryguid:t},pageStyle:2})}}):ejs.navigator.showSearchBar({success:function(t){e.KeyWord=t.keyword,e.PullToRefreshToolObj.refresh()}}),mui(".em-main").on("tap",".em-table-view>li",function(){var t=this,i=t.getAttribute("infoguid"),n=t.getAttribute("infoproperty"),s=t.getAttribute("content"),a=t.getAttribute("isread");0==a&&this.setAttribute("isread",1),"Link"==n?e.setHasRead({infoguid:i},function(e){"1"==e.status.code?ejs.page.open({pageUrl:"http://"+s}):ejs.ui.toast(e.status.text)}):"Attach"==n?e.openAttach(i):ejs.page.open({pageUrl:"./notice_detail.html",pageStyle:1,orientation:1,data:{infoguid:i},success:function(e){}})}),new tabView({container:".em-tabview",isSwipe:"0"})},InitPullRefreshList:function(e){var t=this,i=Util.getExtraDataByKey("categoryguid")||"";t.categoryguid=i,t.PullToRefreshToolObj,t.KeyWord=Util.getExtraDataByKey("keyword")||"";var n="";switch(e){case"newest":n="";break;case"news":n="10";break;case"link":n="20";break;case"att":n="30"}var s="15",a=function(){var e=Config.serverOA9Url+"webinfo_getview_v7";return console.log("\n"+e+"\n"),e},o=function(e){var a={keyword:t.KeyWord,currentpageindex:e,pagesize:s,categoryguid:i,infotype:n},o={params:JSON.stringify(a)};return console.log("\n"+JSON.stringify(a)+"\n"),o},r=function(e){if(1!=e.status.code)return void ejs.ui.toast(e.status.text);var t=null;return t=Util.dataProcess(e,{dataPath:"custom.infolist"}).data,mui.each(t,function(e,t){t.content=string_extend.removeHtmlTag(t.content),t.listType=function(){var e="";switch(t.infoproperty){case"News":e="新闻";break;case"Link":e="链接";break;case"Attach":e="附件"}return e},t.hasHead=""!=t.headnewsurl?"1":"0"}),t},c=function(e){var t=document.querySelector("#item-all").innerHTML;return t},u=function(t){var i="",n="";switch(e){case"newest":i="#pullrefresh",n="#newest";break;case"news":i="#pullrefresh-news",n="#news-list";break;case"link":i="#pullrefresh-link",n="#link-list";break;case"att":i="#pullrefresh-att",n="#att-list"}return"container"==t?i:"listContainer"==t?n:void 0},l=(document.querySelector(".em-tips"),new MiniRefreshBiz({container:u("container"),listContainer:u("listContainer"),isDebug:!1,delay:0,initPageIndex:1,url:a,dataRequest:o,dataChange:r,itemClick:null,template:c,isAutoRender:!0,setting:{down:{successAnim:{isEnable:!0,duration:800},offset:45}},success:function(e,t){t&&e&&e.length<=0}}));return l},openAttach:function(e){var t=this;t.setHasRead({infoguid:e},function(e){if("1"==e.status.code){if(e.custom&&e.custom.sigleinforecord){var t=e.custom.sigleinforecord||{},i=t.attachfiles||[];if(i.length>0){var n=i[0].downloadurl,s=i[0].attfilename;0==Config.customize.showDown?preview.openPreviewUrl({url:n,fileName:s}):ejs.ui.select({title:"",items:["在线预览","下载"],cancelable:1,success:function(e){"0"==e.which?preview.openPreviewUrl({url:n,fileName:s}):"1"==e.which&&preview.downloadFile({url:n,fileName:s,reDownloaded:1},function(){ejs.ui.toast("文件下载完成")})}})}}}else ejs.ui.toast(e.status.text)})},setHasRead:function(e,t){common.ajax({url:"webinfo_getdetail_v7",data:{infoguid:e.infoguid},isShowWaiting:!1},function(e){t&&t(e)},function(e){ejs.ui.toast(Config.TIPS_II)},{isDebug:!0})}};