!function(){"use strict";var a="https:"===document.location.protocol,n=window.BMAP_STATUS_SUCCESS||0,t={container:"#baidumap",isSupportGeolocation:!1,isForceDD:!1,isForceEJS:!1,longitude:120.61990712,latitude:31.31798737};function o(o){o=Util.extend({},t,o),this.container=Util.selector(o.container),this.options=o,this._render(),this.update()}o.prototype={_render:function(){var o=new BMap.Point(this.options.longitude,this.options.latitude);this.currPoint=o,this.myGeo=new BMap.Geocoder,this.map=new BMap.Map(this.container),this.map.centerAndZoom(o,12)},_updateLocation:function(o){var t=this.map;t.centerAndZoom(o,16),t.enableScrollWheelZoom(!0);var i=new BMap.Marker(o);t.clearOverlays(),t.addOverlay(i),t.panTo(o),this.currPoint=o},_changeBDPointByGeolocationLocation:function(o,t,i,n){var e,a,c,s;"object"!=typeof o?(n=n||!1,e=new BMap.Point(o,t),a=new BMap.Convertor,(c=[]).push(e),s=n?1:3,a.translate(c,s,5,function(o){var t=e;o&&0===o.status&&o.points&&(t=o.points[0]),i&&i(t)})):i&&i(o)},_getLocationByEJS:function(o,t){this._callApiGetLocation(o)},_callApiGetLocation:function(i){window.JSBridge.callHandler("util","invokePluginApi",{path:"baidumap.provider.location",dataMap:{}},function(o){var t;"1"==o.code?i&&i(o.result.longitude,o.result.latitude,0):(t="Log："+o.msg+"\n\n",ejs.ui.confirm({title:"温馨提示",message:t+"解决方案：\n1、请前往百度地图开发者平台申请appkey\n2、确保前端EJS为3.2.4以上\n\n3、最新版本组件需在 build.gradle或者 project.gradle 中加入,不然打包会报错\n\n",buttonLabels:["关闭当前页面"],cancelable:0,success:function(o){ejs.page.close()}}))},function(o){ejs.ui.confirm({title:"温馨提示",message:o.msg,buttonLabels:["关闭当前页面"],cancelable:0,success:function(o){ejs.page.close()}}),o&&o(o.msg||"自定义api获取坐标失败")})},_getLocationByDD:function(t,i){dd.device.geolocation.get({targetAccuracy:200,coordinate:0,withReGeocode:!1,onSuccess:function(o){t&&t(o.longitude,o.latitude)},onFail:function(o){i&&i("钉钉获取坐标失败")}})},_getLocationByGeolocation:function(t,o){navigator.geolocation.getCurrentPosition(function(o){t&&t(o.coords.longitude,o.coords.latitude)},function(o){switch(o.code){case o.PERMISSION_DENIED:o&&o("用户拒绝对获取地理位置的请求");break;case o.POSITION_UNAVAILABLE:o&&o("位置信息是不可用的。");break;case o.TIMEOUT:o&&o("请求用户地理位置超时。");break;case o.UNKNOWN_ERROR:default:o&&o("未知错误。")}})},_getLocationByBDBrowser:function(t,i){(new BMap.Geolocation).getCurrentPosition(function(o){this.getStatus()===n?t&&t(o.point):i&&i("failed"+this.getStatus())},{enableHighAccuracy:!0})},_location:function(){var t=this;t.getLocation(function(o){t._updateLocation(o),t.options.success&&t.options.success(o)},t.options.error)},getLocation:function(i,o){function t(o,t){o=o||n.longitude,t=t||n.latitude,e._changeBDPointByGeolocationLocation(o,t,i)}var n=this.options,e=this;n.isForceDD&&Util.os.dd&&window.dd?this._getLocationByDD(t,o):n.isForceEJS&&Util.os.ejs&&window.ejs&&ejs.runtime.getGeolocation?this._getLocationByEJS(t,o):navigator.geolocation&&a&&n.isSupportGeolocation?this._getLocationByGeolocation(t,o):this._getLocationByBDBrowser(t,o)},update:function(o){this.options=Util.extend(this.options,o),this._location()},searchHotPoint:function(i){(i=i||{}).poiRadius=i.poiRadius||1e3,i.numPois=i.numPois||12,this.myGeo.getLocation(this.currPoint,function(o){var t=o.surroundingPois;i.success&&i.success(t)},i)},destroy:function(){this.container=null,this.options=null,this.currPoint=null,this.myGeo=null,this.map=null}},window.BaiduMap=o}();