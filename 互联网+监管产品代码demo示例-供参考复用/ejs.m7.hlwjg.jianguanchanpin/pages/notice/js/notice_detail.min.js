"use strict";Util.loadJs(["js/utils/util.charset.js","js/utils/util.storage.js","pages/common/common.js","pages/common/preview.js","pages/common/formatfile.js","pages/common/util.string_extend.js","pages/common/qr_add_longtap_event.js","pages/notice/js/notice_detail_util.js","pages/common/libs/wangEditor.js","pages/common/libs/jquery-3.2.1.min.js","pages/common/libs/gotop.js"],function(){customBiz.configReady()});var customBiz={configReady:function(){Config.configReady(null,function(){customBiz.initListeners(),customBiz.getNoticeDetail(),customBiz.goTop()},function(e){})},infoguid:Util.getExtraDataByKey("infoguid"),initListeners:function(){var e=this;document.documentElement.style.webkitTouchCallout="none",document.documentElement.style.webkitUserSelect="none";var t=window.wangEditor;e.editor=new t("div1","#editor"),e.editor.create(),e.editor.customConfig.pasteFilterStyle=!1,Zepto(".w-e-text").focus(function(){setTimeout(function(){e.scrollToEnd()},500)});var o=document.querySelector(".em-tab-bar-list");ejs.navigator.setRightBtn({which:0,text:"改变字体",imageUrl:"../common/img/navigator/img_font_nav_btn.png",success:function(t){document.querySelector(".em-mask").style.display="none",e.hideFeed(),document.querySelector("#editor div").blur(),o.classList.contains("em-transition-vertical-down")?NoticeDetailUtil.toggleTabbarMenu.closeTabbar():NoticeDetailUtil.toggleTabbarMenu.openTabbar()}}),mui(".em-tab-bar-list").on("tap","li",function(){var t=this.querySelector("span").innerText.trim();switch(Zepto(this).addClass("selected").siblings().removeClass("selected"),e.allLabels=document.querySelector(".em-content").querySelectorAll("p,h1,h2,h3,span,label"),t){case"小":e.fontsize="14px",e.lineHeight="20px";break;case"中":e.fontsize="18.8px",e.lineHeight="32px";break;case"大":e.fontsize="20.8px",e.lineHeight="36px";break;case"超大":e.fontsize="30.8px",e.lineHeight="45px"}mui.each(e.allLabels,function(t,o){o.style.fontSize=e.fontsize,o.style.lineHeight=e.lineHeight}),document.querySelector(".em-content").style.fontSize=e.fontsize,document.querySelector(".em-content").style.lineHeight=e.lineHeight,document.querySelector(".em-content").style.height=document.querySelector(".mui-scroll").scrollHeight+"px",NoticeDetailUtil.toggleTabbarMenu.closeTabbar()}),document.querySelector(".em-mask").addEventListener("tap",function(){NoticeDetailUtil.toggleTabbarMenu.closeTabbar(),e.hideFeed(),this.style.display="none",document.querySelector("#editor div").blur(),e.editor.txt.html(""),document.querySelector(".em-action-top .em-button").innerText="发布",ejs.device.closeInputKeyboard({success:function(e){},error:function(e){}})}),mui("#attachList").on("tap","li",function(){var e=this,t=e.querySelector(".em-attach-name").innerText.trim(),o=(e.querySelector(".em-attach-size").innerText.trim(),e.getAttribute("downloadurl"));preview.openPreviewUrl({url:o,fileName:t})}),mui.init({gestureConfig:{longtap:!0}}),mui("#attachList").on("longtap","li",function(){var e=this,t=e.querySelector(".em-attach-name").innerText.trim(),o=(e.querySelector(".em-attach-size").innerText.trim(),e.getAttribute("downloadurl"));ejs.ui.select({title:"",items:["在线预览","下载"],cancelable:1,success:function(e){"0"==e.which?preview.openPreviewUrl({url:o,fileName:t}):"1"==e.which&&preview.downloadFile({url:o,fileName:t,reDownloaded:"0",isBackground:0},function(){ejs.ui.toast("文件下载完成")})}})}),document.querySelector("#feedbackContent").addEventListener("tap",function(){document.querySelector(".em-mask").style.display="block",e.showFeed()}),document.querySelector(".em-action-cancel").addEventListener("tap",function(){document.querySelector(".em-mask").style.display="none",e.hideFeed(),document.querySelector("#editor div").blur(),e.editor.txt.html(""),document.querySelector(".em-action-top .em-button").innerText="发布"}),document.querySelector(".em-button").addEventListener("tap",function(){1!=e.editFeed?e.addFeedback():e.editFeedback()}),document.querySelector(".em-bottom-comment").addEventListener("tap",function(){var e=$(".em-mail-feedback-content").offset().top;$("html,body").animate({scrollTop:e},400)}),mui(".em-mail-feedback-content").on("tap","li",function(t){var o=this,i=t.target.classList,n=o.getAttribute("feedbackguid");o.getAttribute("feedbackcontent");if(i.contains("em-recall"))ejs.ui.confirm({title:"温馨提示",message:"确认撤回吗?",buttonLabels:["取消","确定"],cancelable:1,success:function(t){"1"==t.which&&e.withdrawFeedback(n)},error:function(e){}});else if(i.contains("em-update")){var c=this.querySelector(".em-feed-title"),a=c.innerHTML;e.editFeed=1,e.feedbackguid=n,console.log(n),document.querySelector(".em-mask").style.display="block",document.querySelector(".em-action-top .em-button").innerText="修改",e.showFeed(),document.querySelector(".w-e-text").innerHTML=a}})},getNoticeDetail:function(e){var t=this;common.ajax({url:"webinfo_getdetail_v7",data:{infoguid:t.infoguid},dataPath:"custom",isShowWaiting:!1},function(e){if(e.data&&e.data.sigleinforecord){Zepto(".mui-content").css("display","block");var o=e.data.sigleinforecord||{},i=o.attachfiles||[],n=o.commentable;o.infodate=DateUtil.getDate(o.infodate,"yyyy-mm-dd")+" "+DateUtil.getTime(o.infodate,"hh:mm");var c=document.getElementById("top-Template").innerHTML,a=Mustache.render(c,o);Zepto("#topContent").html(a),o.content&&""!=o.content?Zepto(".em-content").html(o.content):Zepto(".em-content").css("display","none");var r=document.querySelector(".em-content");if(NoticeDetailUtil.handleRichContent(r,{isPrevImage:!0}),i.length>0){var s=document.getElementById("attachlist-template").innerHTML,l="";mui.each(i,function(e,t){t.attachlength=FormatFile.getKMByByte(t.attachlength),t.attachfileicon=FormatFile.getFileIcon(t.attfilename)}),l=Mustache.render(s,o),document.getElementById("attachList").innerHTML=l}new QRtoLongTap(".em-content"),t.getFeedbackList(),"1"==n?document.querySelector(".em-bottom-nav").style.display="block":document.querySelector(".em-bottom-nav").style.display="none";Zepto(".mui-scroll-wrapper img").length}},function(e){ejs.ui.toast(Config.TIPS_II)},{isDebug:!0})},getFeedbackList:function(e){var t=this;common.ajax({url:"webinfo_getfeedbackview_v7",data:{infoguid:t.infoguid},isShowWaiting:!1},function(e){if(e.custom){var t=e.custom.feedbacklist;if(t&&Array.isArray(t)&&t.length>0){var o=NoticeDetailUtil.generateFeedListHtml(e),i=document.querySelector(".em-mail-feedback-content");i.innerHTML=o,NoticeDetailUtil.handleRichContent(i,{isPrevImage:!1}),document.querySelector(".em-feedbck-num").innerText=t.length,new QRtoLongTap(".em-mail-feedback-wrapper")}}},function(e){ejs.ui.toast(Config.TIPS_II)},{isDebug:!0})},addFeedback:function(e){var t=this,o=t.editor.txt.html();return console.log("text:"+t.editor.txt.text()),""==t.editor.txt.text().replace(/(\s+)/g,"").replace(/&nbsp;/g,"")?void ejs.ui.toast("请填写反馈内容！"):void common.ajax({url:"webinfo_addfeedback_v7",data:{infoguid:t.infoguid,feedbackcontent:o},isShowWaiting:!0},function(e){"1"==e.status.code&&(ejs.ui.toast("反馈成功！"),t.editor.txt.html(""),t.hideFeed(),document.querySelector(".em-mask").style.display="none",document.querySelector("#editor div").blur(),t.getFeedbackList())},function(e){ejs.ui.toast(Config.TIPS_II)},{isDebug:!0})},withdrawFeedback:function(e){var t=this;common.ajax({url:"webinfo_delfeedback_v7",data:{feedbackguid:e},isShowWaiting:!1},function(e){"1"==e.status.code?(ejs.ui.toast("撤回成功！"),t.getFeedbackList()):ejs.ui.toast(e.status.text)},function(e){ejs.ui.toast(Config.TIPS_II)},{isDebug:!0})},editFeedback:function(){var e=this,t=e.editor.txt.html();if(""==e.editor.txt.text().replace(/(\s+)/g,"").replace(/&nbsp;/g,""))return void ejs.ui.toast("请填写反馈内容！");var o={feedbackguid:e.feedbackguid,newfeedbackcontent:t};ejs.ui.showWaiting("正在加载..."),common.ajax({url:"webinfo_editfeedback_v7",data:o},function(t){ejs.ui.closeWaiting(),"1"==t.status.code&&(ejs.ui.toast("修改反馈成功！"),e.editSuccess())},function(e){ejs.ui.toast(Config.TIPS_II)},{isDebug:!0})},editSuccess:function(e){var t=this;t.editor.txt.html(""),t.editFeed=0,document.querySelector(".em-quickfeedback-content .em-button").innerText="发布",t.hideFeed(),document.querySelector(".em-mask").style.display="none",document.querySelector("#editor div").blur(),t.getFeedbackList()},goTop:function(){new GoTop({hide:!0,url:"../common/img/gotop/img_backtop_btn@2x.png",state:"",height:"50px",width:"50px",scrollTop:200,time:500,aimation:"animated bounceInDown",toTop:"",toShow:"",toHide:function(){console.log("我消失了....")},go:""})},showFeed:function(e){var t=this;t.scrollTop=document.body.scrollTop,document.querySelector(".em-quickfeedback-wrapper").style.display="block",setTimeout(function(){document.querySelector(".em-quickfeedback-wrapper").classList.add("showFeed"),document.querySelector(".mui-content").classList.add("em-warpper-show")},30)},hideFeed:function(e){var t=this;document.querySelector(".em-quickfeedback-wrapper").classList.remove("showFeed"),document.querySelector(".mui-content").classList.remove("em-warpper-show"),document.body.scrollTop=t.scrollTop,document.querySelector(".em-quickfeedback-wrapper").style.display="none";$(".em-mail-feedback-content").offset().top},scrollToEnd:function(){}};