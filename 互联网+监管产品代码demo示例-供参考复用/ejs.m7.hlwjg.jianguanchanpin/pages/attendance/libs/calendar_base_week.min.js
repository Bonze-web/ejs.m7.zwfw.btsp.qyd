!function(){"use strict";function t(t){t=mui.extend({},n,t),this._initData(t),this._bindEvent()}var e=function(){},n={container:".em-calendar-wrapper-week",template:e,dataRequest:e,isDebug:!0};t.prototype={_initData:function(t){var e=this;e.options=t,e._initVar(),e.setDate(new Date)},_initVar:function(){var t=this;t.currentFirstDate=null;var e=new Date,n=e.getMonth()+1,a=e.getDate();t.currentDate=e.getFullYear()+"-"+t.tom(n)+"-"+t.tod(a)},tom:function(t){return t=parseInt(t)>9?""+parseInt(t):"0"+parseInt(t)},tod:function(t){return t=parseInt(t)>9?""+parseInt(t):"0"+parseInt(t)},addDate:function(t,e){return t.setDate(t.getDate()+e),t},setDate:function(t){var e=this,n=t.getDay();t=e.addDate(t,n*-1),e.currentFirstDate=new Date(t);var a=[],n=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][t.getDay()];e.options.isDebug&&console.log("计算周："+t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()),e.currnetMonth=t.getFullYear()+"-"+(e.tom(t.getMonth()+1)+"-"+e.tom(t.getDate()));for(var r=0;r<7;r++)0==r?t:e.addDate(t,1),a.push({week:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][t.getDay()],month:e.tom(t.getMonth()+1),day:e.tod(t.getDate()),date:t.getFullYear()+"-"+e.tom(t.getMonth()+1)+"-"+e.tod(t.getDate())});e.render(a)},render:function(t){var e=this;e.options.dataRequest(function(n){var a=n||[];e.options.isDebug&&console.log("*********业务数据：********:\n"+JSON.stringify(a)+"\n");for(var r=0;r<a.length;r++)for(var i=0;i<t.length;i++)a[r].date==t[i].date&&(t[i].isSelected="1");var o="";o+=e.options.weekHeader(),o+='<div class="em-calendar-content week">',mui.each(t,function(t,n){var a=e.options.template(n,e.currentDate,t);o+=Mustache.render(a,n)}),o+="</div>",document.querySelector(e.options.container).innerHTML=o},e)},_bindEvent:function(){var t=this,e=t.options.preEvent,n=(t.options.nextEvent,t.options.itemOnclick);document.querySelector(t.options.container).addEventListener("swiperight",function(){t.setDate(t.addDate(t.currentFirstDate,-7)),e&&e(t.currnetMonth)}),document.querySelector(t.options.container).addEventListener("swipeleft",function(){t.setDate(t.addDate(t.currentFirstDate,7)),e&&e(t.currnetMonth)}),mui(t.options.container).on("tap",".em-calendar-item",function(){var t=this.getAttribute("date"),e=this.querySelector(".lunar").innerText.trim();Zepto(this).addClass("em-calendar-active").siblings().removeClass("em-calendar-active"),n&&n.call(this,{date:t,lunar:e})})},refresh:function(){var t=this;t.setDate(new Date)}},window.CalendarWeek=t}();