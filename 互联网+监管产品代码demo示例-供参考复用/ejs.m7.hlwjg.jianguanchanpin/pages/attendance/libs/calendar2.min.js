!function(){"use strict";function n(n){n=mui.extend({},a,n),this.container=this._selector(n.container),this._initData(n)}var a={container:"#calendar",isLunar:!0,isSwipeH:!0,isSwipeV:!0};n.prototype={_initData:function(n){if(this.options=n,!this._validate())throw new Error("验证错误，日历的传入格式非法，请检查代码");this._initParams(),this._addEvent()},_initParams:function(){var n=this;n.newDate=new Date,n.nowYear=n.newDate.getFullYear(),n.nowMonth=n.newDate.getMonth()+1,n.nowDay=n.newDate.getDate();var a=new Date,t=a.getMonth()+1,e=a.getDate();n.currentDate=a.getFullYear()+"-"+n.tom(t)+"-"+n.tod(e),n.nowMonth=String(n.nowMonth),1==n.nowMonth.length&&(n.nowMonth="0"+n.nowMonth),n.CalendarData=new Array(100),n.madd=new Array(12),n.tgString="甲乙丙丁戊己庚辛壬癸",n.dzString="子丑寅卯辰巳午未申酉戌亥",n.numString="一二三四五六七八九十",n.monString="正二三四五六七八九十冬腊",n.weekString="日一二三四五六",n.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",n.cYear,n.cMonth,n.cDay,n.TheDate,n.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),n.madd[0]=0,n.madd[1]=31,n.madd[2]=59,n.madd[3]=90,n.madd[4]=120,n.madd[5]=151,n.madd[6]=181,n.madd[7]=212,n.madd[8]=243,n.madd[9]=273,n.madd[10]=304,n.madd[11]=334,this.refresh(n.nowYear,n.nowMonth,n.nowDay)},refresh:function(n,a,t){var e=this;e.nowYear=parseInt(n),e.nowMonth=parseInt(a),e.nowDay=parseInt(t),e.nowMonth=e.tom(e.nowMonth),e.nowDay=e.tod(e.nowDay);var o=new Date(Date.parse(e.nowYear+"/"+e.nowMonth+"/01")),r=o.getDay();r=parseInt(r),0==r&&(r=7);var i=e._judgeDaysByYearMonth(e.nowYear,e.nowMonth),s={},d=[],h=e._judgeDaysByYearMonth(e.nowYear,e.nowMonth-1);h=parseInt(h);for(var c=1;c<r+1;c++){var w=h-r+c,u="day"+c,l="lunar"+c;s[u]=w,s[l]=e._getLunar(w,"m-1"),d.push({day:w,lunar:e._getLunar(w,"m-1"),date:e.nowYear+"-"+e.tom(e.nowMonth-1)+"-"+e.tod(w),isforbid:"0"})}var p=0;if("28"==i){p=28+r;for(var f=r+1,g=1;f<28+r+1;f++,g++){var u="day"+f,l="lunar"+f;s[u]=g,s[l]=e._getLunar(g),d.push({day:g,lunar:e._getLunar(g),date:e.nowYear+"-"+e.tom(e.nowMonth)+"-"+e.tod(g),isforbid:"1"})}}if("29"==i){p=29+r;for(var f=r+1,g=1;f<29+r+1;f++,g++){var u="day"+f,l="lunar"+f;s[u]=g,s[l]=e._getLunar(g),d.push({day:g,lunar:e._getLunar(g),date:e.nowYear+"-"+e.tom(e.nowMonth)+"-"+e.tod(g),isforbid:"1"})}}if("30"==i){p=30+r;for(var f=r+1,g=1;f<30+r+1;f++,g++){var u="day"+f,l="lunar"+f;s[u]=g,s[l]=e._getLunar(g),d.push({day:g,lunar:e._getLunar(g),date:e.nowYear+"-"+e.tom(e.nowMonth)+"-"+e.tod(g),isforbid:"1"})}}if("31"==i){p=31+r;for(var f=r+1,g=1;f<31+r+1;f++,g++){var u="day"+f,l="lunar"+f;s[u]=g,s[l]=e._getLunar(g),d.push({day:g,lunar:e._getLunar(g),date:e.nowYear+"-"+e.tom(e.nowMonth)+"-"+e.tod(g),isforbid:"1"})}}for(var m=p+1,D=1;m<=42;m++,D++){var u="day"+m,l="lunar"+m;s[u]=D,s[l]=e._getLunar(D,"m+1"),d.push({day:D,lunar:e._getLunar(D,"m+1"),date:e.nowYear+"-"+e.tom(parseInt(e.nowMonth)+parseInt(1))+"-"+e.tod(D),isforbid:"0"})}e.options.isDebug&&console.log("日历数据格式："+JSON.stringify(d)),this._render(s,d)},_render:function(n,a){var t=this,e="";e+='<div class="em-week">',e+='<span class="em-red">日</span>',e+="<span>一</span>",e+="<span>二</span>",e+="<span>三</span>",e+="<span>四</span>",e+="<span>五</span>",e+='<span class="em-red">六</span>',e+="</div>",e+='<div class="em-calendar-content">';for(var o=0,r=a.length;o<r;o++)e+=a[o].date==t.currentDate?1==a[o].isforbid?'<div class="em-calendar-item em-calendar-active  isforbid'+a[o].isforbid+'" date="'+a[o].date+'">':'<div class="em-calendar-item isforbid'+a[o].isforbid+'" date="'+a[o].date+'">':15==o?'<div class="em-calendar-item em-calendar-late isforbid'+a[o].isforbid+'" date="'+a[o].date+'">':'<div class="em-calendar-item  isforbid'+a[o].isforbid+'" date="'+a[o].date+'">',e+='<span class="day">'+a[o].day+"</span>",e+='<p class="lunar">'+a[o].lunar+"</p>",16==o?e+='<span class="dot dot-type1"></span>':17==o&&(e+='<span class="dot dot-type1"></span>'),e+="</div>";e+="</div>",t.options.isDebug&&console.log("日历模板字符串："+e),this._selector(this.options.container).innerHTML=e},_addEvent:function(){var n=this,a=n.options.itemClick,t=n.options.swipeCallback;mui(n.options.container).on("tap",".em-calendar-item",function(){if(!this.classList.contains("isforbid0")){Zepto(this).addClass("em-calendar-active").siblings().removeClass("em-calendar-active");var n=this.getAttribute("date"),t=this.querySelector(".lunar").innerText.trim();a&&a({date:n,lunar:t})}}),n.options.isSwipeH&&(n._selector(n.options.container).addEventListener("swiperight",function(){n.options.isDebug&&console.log("你正在向右滑动"),n.nowMonth=parseInt(n.nowMonth)-parseInt(1),0==n.nowMonth&&(n.nowYear=n.nowYear-1,n.nowMonth=12),n.nowMonth=n.tom(n.nowMonth),n.nowDay=n.tod(n.nowDay),n.refresh(n.nowYear,n.nowMonth,n.nowDay),t&&t({year:n.nowYear,month:n.nowMonth,day:n.nowDay})}),n._selector(n.options.container).addEventListener("swipeleft",function(){n.options.isDebug&&console.log("你正在向左滑动"),n.nowMonth=parseInt(n.nowMonth)+parseInt(1),13==n.nowMonth&&(n.nowYear=n.nowYear+1,n.nowMonth=1),n.nowMonth=n.tom(n.nowMonth),n.nowDay=n.tod(n.nowDay),n.refresh(n.nowYear,n.nowMonth,n.nowDay),t&&t({year:n.nowYear,month:n.nowMonth,day:n.nowDay})})),n.options.isSwipeV},_getLunar:function(n,a){var t=this,e=t.nowYear,o=t.nowMonth;o=parseInt(o),"m+1"===a&&(o=1+o,13==o&&(o=1)),"m-1"===a&&(o=-1+o,0==o&&(o=1));var r=n;new Date(Date.parse(e+"/"+o+"/"+r)).getDay();return this._getLunarDay(e,o,r)},_judgeDaysByYearMonth:function(n,a){var t=this;if(void 0==n||null==n)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(void 0==a||null==a)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";var n=parseInt(n),a=parseInt(a);return 0==a&&(n--,a=12),2==a?n%4==0&&n%100!=0||n%400==0?"29":"28":t._inArray(a,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var n=!0;return this.options.container||(n=!1),n},_selector:function(n){return document.querySelector(n)},_inArray:function(n,a){if(!Array.isArray(a))throw"arguments is not Array";for(var t=0,e=a.length;t<e;t++)if(n==a[t])return!0;return!1},_sibling:function(n,a){for(var t=n.parentNode.firstChild;t;t=t.nextSibling)1===t.nodeType&&t!==n&&a&&"function"==typeof a&&a(t)},_getBit:function(n,a){return n>>a&1},_e2c:function(){var n=this;n.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var a,t,e,o,r=!1,i=n.TheDate.getYear();for(i<1900&&(i+=1900),a=365*(i-1921)+Math.floor((i-1921)/4)+n.madd[n.TheDate.getMonth()]+n.TheDate.getDate()-38,n.TheDate.getYear()%4==0&&n.TheDate.getMonth()>1&&a++,t=0;;t++){for(o=n.CalendarData[t]<4095?11:12,e=o;e>=0;e--){if(a<=29+n._getBit(n.CalendarData[t],e)){r=!0;break}a=a-29-n._getBit(n.CalendarData[t],e)}if(r)break}n.cYear=1921+t,n.cMonth=o-e+1,n.cDay=a,12==o&&(n.cMonth==Math.floor(n.CalendarData[t]/65536)+1&&(n.cMonth=1-n.cMonth),n.cMonth>Math.floor(n.CalendarData[t]/65536)+1&&n.cMonth--)},_getcDateString:function(){var n=this,a="";return n.cMonth<1,a+=n.cDay<11?"初":n.cDay<20?"十":n.cDay<30?"廿":"三十",n.cDay%10==0&&10!=n.cDay||(a+=n.numString.charAt((n.cDay-1)%10)),a},_getLunarDay:function(n,a,t){var e=this;return n<1921||n>2080?"":(a=parseInt(a)>0?a-1:11,e._e2c(n,a,t),e._getcDateString())},tom:function(n){return n=parseInt(n)>9?""+parseInt(n):"0"+parseInt(n)},tod:function(n){return n=parseInt(n)>9?""+parseInt(n):"0"+parseInt(n)},getTime:function(n){var a=new Date,t=a.getHours(),e=a.getMinutes(),o=a.getSeconds(),r="";return"hh:mm"==n?r+=t+":"+e:"hh:mm:ss"==n&&(r+=t+":"+e+":"+o),r}},window.Calendar2=n}();