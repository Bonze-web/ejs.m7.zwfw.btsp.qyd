!function(){"use strict";function t(){}function e(t){if(t=mui.extend({},a,t),!this._selector(t.container))throw new Error("传入的日历组件容器Selector #id不存在或者为空，请仔细检查！");this.container=this._selector(t.container),this._initData(t)}var a={container:"#calendar",swiper:".swiper-container",isLunar:!0,isSwipeH:!0,isSwipeV:!0,swipeCallback:t,pre:".pre",preCallback:t,next:".next",nextCallback:t,itemClick:t,dataRequest:t,isDebug:!1};e.prototype={_initData:function(t){var e=this;this.options=t,this.CreateDOMFactory(function(){e._initParams()})},_initParams:function(){var t=this;t.nowYear=t.DateObj().getFullYear(),t.nowMonth=t.tod(t.DateObj().getMonth()+1),t.nowDay=t.tod(t.DateObj().getDate()),t.currentDate=t.nowYear+"-"+t.nowMonth+"-"+t.nowDay,t.CalendarData=new Array(100),t.madd=new Array(12),t.tgString="甲乙丙丁戊己庚辛壬癸",t.dzString="子丑寅卯辰巳午未申酉戌亥",t.numString="一二三四五六七八九十",t.monString="正二三四五六七八九十冬腊",t.weekString="日一二三四五六",t.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",t.cYear,t.cMonth,t.cDay,t.TheDate,t.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),t.madd[0]=0,t.madd[1]=31,t.madd[2]=59,t.madd[3]=90,t.madd[4]=120,t.madd[5]=151,t.madd[6]=181,t.madd[7]=212,t.madd[8]=243,t.madd[9]=273,t.madd[10]=304,t.madd[11]=334,t.initEntry()},initEntry:function(t){var e=this,a=mui.extend({year:"",month:"",day:""},t);a.year?a.year=t.year:a.year=e.DateObj().getFullYear(),a.month?a.month=t.month:a.month=e.tod(e.DateObj().getMonth()+1);var n=a.year,r=a.month,o=parseInt(r)-parseInt(1);0==o&&(n=a.year-1,o=12),o=e.tom(o);var i=e.tod("01");console.log("(前)初始化年月日："+n+"-"+o+"-"+i);var s=[];e.refreshData({year:n,month:o,day:i},function(t){s.push({templ:t});var n=a.year||e.DateObj().getFullYear(),r=a.month||e.tod(e.DateObj().getMonth()+1),o=a.day||e.tod(e.DateObj().getDate());e.curYear=a.year||e.DateObj().getFullYear(),e.curMonth=a.month||e.tod(e.DateObj().getMonth()+1),e.curDay=a.day||e.tod(e.DateObj().getDate()),console.log("(中)初始化年月日："+n+"-"+r+"-"+o),e.refreshData({year:n,month:r,day:o},function(t){s.push({templ:t});for(var a=e.SLIDER_ITEM_CONTAINER,n="",r=0;r<s.length;r++)n+=Mustache.render(a,s[r]);document.querySelector(".swiper-wrapper").innerHTML=n,e._addEvent()})})},refreshData:function(t,e){var a=this;a.nowYear=parseInt(t.year),a.nowMonth=a.tom(t.month),a.nowDay=a.tod(t.day);var n=new Date(Date.parse(a.nowYear+"/"+a.nowMonth+"/01")),r=n.getDay();r=parseInt(r),0==r&&(r=7);var o=a._judgeDaysByYearMonth(a.nowYear,a.nowMonth);a.dayCount=o;var i={},s=[],d=a._judgeDaysByYearMonth(a.nowYear,parseInt(a.nowMonth-1));d=parseInt(d);for(var c=1;c<r+1;c++){var l=d-r+c,u="day"+c,p="lunar"+c,h=parseInt(a.nowYear),v=parseInt(a.nowMonth);v=-1+v,0==v&&(v=12,h=parseInt(a.nowYear-1)),i[u]=l,i[p]=a._getLunar(l,v,h),s.push({day:l,lunar:a._getLunar(l,v,h),date:h+"-"+a.tom(v)+"-"+a.tod(l),isforbid:"0",tip:"prev"})}var m=0;if("28"==o){m=28+r;for(var f=r+1,y=1;f<28+r+1;f++,y++){var u="day"+f,p="lunar"+f;i[u]=y,i[p]=a._getLunar(y),s.push({day:y,lunar:a._getLunar(y),date:a.nowYear+"-"+a.tom(a.nowMonth)+"-"+a.tod(y),isforbid:"1"})}}if("29"==o){m=29+r;for(var f=r+1,y=1;f<29+r+1;f++,y++){var u="day"+f,p="lunar"+f;i[u]=y,i[p]=a._getLunar(y),s.push({day:y,lunar:a._getLunar(y),date:a.nowYear+"-"+a.tom(a.nowMonth)+"-"+a.tod(y),isforbid:"1"})}}if("30"==o){m=30+r;for(var f=r+1,y=1;f<30+r+1;f++,y++){var u="day"+f,p="lunar"+f;i[u]=y,i[p]=a._getLunar(y),s.push({day:y,lunar:a._getLunar(y),date:a.nowYear+"-"+a.tom(a.nowMonth)+"-"+a.tod(y),isforbid:"1"})}}if("31"==o){m=31+r;for(var f=r+1,y=1;f<31+r+1;f++,y++){var u="day"+f,p="lunar"+f;i[u]=y,i[p]=a._getLunar(y),s.push({day:y,lunar:a._getLunar(y),date:a.nowYear+"-"+a.tom(a.nowMonth)+"-"+a.tod(y),isforbid:"1"})}}for(var g=m+1,D=1;g<=42;g++,D++){var u="day"+g,p="lunar"+g,w=parseInt(a.nowYear),I=parseInt(a.nowMonth)+parseInt(1);13==I&&(I=1,w=parseInt(a.nowYear)+parseInt(1)),i[u]=D,i[p]=a._getLunar(D,I,w),s.push({day:D,lunar:a._getLunar(D,I,w),date:w+"-"+a.tom(I)+"-"+a.tod(D),isforbid:"0",tip:"next"})}a.options.isDebug&&console.log("*********日历格式********:\n"+JSON.stringify(s)+"\n"),this._render({fileInfo:i,tmpInfo:s,activeSlideNode:t.activeSlideNode},e)},_render:function(t,e){var a=this,n=a.nowYear+"-"+a.nowMonth+"-";a.options.dataRequest(n,function(n){var r=n||[];a.options.isDebug&&console.log("*********业务数据：********:\n"+JSON.stringify(r)+"\n");for(var o=0;o<r.length;o++)for(var i=0;i<t.tmpInfo.length;i++)r[o].date==t.tmpInfo[i].date&&(t.tmpInfo[i].isSelected="1");for(var s="",i=0,d=t.tmpInfo.length;i<d;i++)s+=Mustache.render(a.options.dayTempl(t.tmpInfo[i],a.currentDate),t.tmpInfo[i]);a.options.isDebug&&console.log("*********日历模板********:\n"+s+"\n"),"function"==typeof e&&e&&e(s)},a)},CreateDOMFactory:function(t){var e=this;e.HEADER_BAR='<div class="em-calendar-container"><div class="em-week">\t\t\t\t\t\t\t<span class="em-red">日</span>\t\t\t\t\t\t\t<span>一</span>\t\t\t\t\t\t\t<span>二</span>\t\t\t\t\t\t\t<span>三</span>\t\t\t\t\t\t\t<span>四</span>\t\t\t\t\t\t\t<span>五</span>\t\t\t\t\t\t\t<span class="em-red">六</span>\t\t\t\t\t\t</div>',e.HEADER='<div class="swiper-container">\t\t\t\t\t\t\t<div class="swiper-wrapper">',e.FOOTER="</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>",e.SLIDER_ITEM_CONTAINER='<div class="swiper-slide">\t\t\t\t\t\t\t\t\t<div class="em-calendar-content">\t\t\t\t\t\t\t\t\t<div class="em-calendar-wrapper">{{{templ}}}</div>\t\t\t\t\t\t\t\t</div></div>';var a=e.HEADER_BAR+e.HEADER+e.FOOTER;e.container.innerHTML=a,t&&t()},uniqueArray:function(t,e){for(var a=[t[0]],n=1;n<t.length;n++){for(var r=t[n],o=!1,i=0;i<a.length;i++)if(r[e]==a[i][e]){o=!0;break}o||a.push(r)}return a},_addEvent:function(){var t,e=this,a=e.options.itemClick,n=e.options.swipeCallback,r=(e.options.preCallback,e.options.nextCallback,e.options.backToTodayCallback),o=parseInt(e.curMonth)-parseInt(2),i=e.curYear,s=parseInt(e.curMonth),d=e.DateObj().getFullYear(),c=e.curYear,l=0,u=e.curYear,p=parseInt(e.curMonth),h=e.curDay;e.mySwiper=new Swiper(".swiper-container",{loop:!1,initialSlide:1,onSlideNextStart:function(a){if(l++,"1"==l?(h=e.curDay,p=parseInt(e.curMonth)):(p+=1,h="01"),"13"==p&&(u=parseInt(u)+parseInt(1),p=1),e.options.isDebug&&(console.log("currMonthIndex："+p),console.log("currYearIndex："+u),console.log(">>>>>>"+e.nowYear+"-"+e.nowMonth+"-"+e.nowDay)),n&&n({year:u,month:e.tom(p),day:h,date:u+"-"+e.tom(p)+"-"+h,dayCount:e.dayCount}),s+=parseInt(1),13==s&&(c=d+1,s=1),t=e.tom(s),console.log("(后)初始化年月日："+c+"-"+t+"-01"),e.refreshData({year:c,month:t,day:"01"},function(t){var n=[];n.push({templ:t});for(var r=e.SLIDER_ITEM_CONTAINER,o="",i=0;i<n.length;i++)o+=Mustache.render(r,n[i]);a.appendSlide(o)}),e.tom(p)!==e.curMonth){var r=document.querySelector(".swiper-slide-active .em-calendar-active");r&&r.classList.remove("em-calendar-active"),document.querySelector(".swiper-slide-active .isforbid1").classList.add("em-calendar-active")}},onSlidePrevStart:function(t){l--,"1"==l?(h=e.curDay,p=parseInt(e.curMonth)):(p=parseInt(p)-parseInt(1),h="01"),0==p&&(u=parseInt(u)-parseInt(1),p=12),e.options.isDebug&&(console.log("currMonthIndex："+p),console.log("currYearIndex："+u),console.log("当前"+e.nowYear+"-"+e.nowMonth+"月份")),n&&n({year:u,month:e.tom(p),day:h,date:u+"-"+e.tom(p)+"-"+h,dayCount:e.dayCount}),0==o&&(i--,o=12);var a=e.tom(o);if(o--,e.refreshData({year:i,month:a,day:"01"},function(a){var n=[];n.push({templ:a});for(var r=e.SLIDER_ITEM_CONTAINER,o="",i=0;i<n.length;i++)o+=Mustache.render(r,n[i]);t.prependSlide(o)}),e.tom(p)!==e.curMonth){var r=document.querySelector(".swiper-slide-active .em-calendar-active");r&&r.classList.remove("em-calendar-active"),document.querySelector(".swiper-slide-active .isforbid1").classList.add("em-calendar-active")}}}),mui(".swiper-container").off(),mui(".swiper-container").on("tap",".em-calendar-item",function(){var t=this.getAttribute("date");if(this.classList.contains("tipprev")?(e.slidePrev(),Zepto('.swiper-slide-active [date="'+t+'"]').addClass("em-calendar-active").siblings().removeClass("em-calendar-active")):this.classList.contains("tipnext")?(e.slideNext(),Zepto('.swiper-slide-active [date="'+t+'"]').addClass("em-calendar-active").siblings().removeClass("em-calendar-active")):Zepto(this).addClass("em-calendar-active").siblings().removeClass("em-calendar-active"),this.querySelector(".lunar"))var n=this.querySelector(".lunar").innerText.trim();else var n="已签";a&&a({date:t,lunar:n})}),e._selector(e.options.pre)&&e._selector(e.options.pre).addEventListener("tap",function(){e.mySwiper.slidePrev()}),e._selector(e.options.next)&&e._selector(e.options.next).addEventListener("tap",function(){e.mySwiper.slideNext()}),e._selector(e.options.backToToday)&&e._selector(e.options.backToToday).addEventListener("tap",function(){var t=e.DateObj().getFullYear(),a=e.tod(e.DateObj().getMonth()+1),n=e.tod(e.DateObj().getDate());e.refresh(),r&&r({year:t,month:a,day:n,date:t+"-"+a+"-"+n})})},slidePrev:function(t){var e=this;e.mySwiper.slidePrev()},slideNext:function(t){var e=this;e.mySwiper.slideNext()},refresh:function(t){var e=this;e.destroySwiper(),e.initEntry(t)},destroySwiper:function(){var t=this;t.mySwiper.destroy(!0)},_getLunar:function(t,e,a){var n=this,r=a||n.nowYear,o=e||n.nowMonth,i=t;return this._getLunarDay(r,o,i)},_judgeDaysByYearMonth:function(t,e){var a=this;if(void 0==t||null==t)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(void 0==e||null==e)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";var t=parseInt(t),e=parseInt(e);return 0==e&&(t--,e=12),2==e?t%4==0&&t%100!=0||t%400==0?"29":"28":a._inArray(e,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var t=!0;return this.options.container||(t=!1),t},_selector:function(t){return document.querySelector(t)},_inArray:function(t,e){if(!Array.isArray(e))throw"arguments is not Array";for(var a=0,n=e.length;a<n;a++)if(t==e[a])return!0;return!1},_sibling:function(t,e){for(var a=t.parentNode.firstChild;a;a=a.nextSibling)1===a.nodeType&&a!==t&&e&&"function"==typeof e&&e(a)},_getBit:function(t,e){return t>>e&1},_e2c:function(){var t=this;t.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var e,a,n,r,o=!1,i=t.TheDate.getYear();for(i<1900&&(i+=1900),e=365*(i-1921)+Math.floor((i-1921)/4)+t.madd[t.TheDate.getMonth()]+t.TheDate.getDate()-38,t.TheDate.getYear()%4==0&&t.TheDate.getMonth()>1&&e++,a=0;;a++){for(r=t.CalendarData[a]<4095?11:12,n=r;n>=0;n--){if(e<=29+t._getBit(t.CalendarData[a],n)){o=!0;break}e=e-29-t._getBit(t.CalendarData[a],n)}if(o)break}t.cYear=1921+a,t.cMonth=r-n+1,t.cDay=e,12==r&&(t.cMonth==Math.floor(t.CalendarData[a]/65536)+1&&(t.cMonth=1-t.cMonth),t.cMonth>Math.floor(t.CalendarData[a]/65536)+1&&t.cMonth--)},_getcDateString:function(){var t=this,e="";return t.cMonth<1,e+=t.cDay<11?"初":t.cDay<20?"十":t.cDay<30?"廿":"三十",t.cDay%10==0&&10!=t.cDay||(e+=t.numString.charAt((t.cDay-1)%10)),e},_getLunarDay:function(t,e,a){var n=this;return t<1921||t>2080?"":(e=parseInt(e)>0?e-1:11,n._e2c(t,e,a),n._getcDateString())},tom:function(t){return t=parseInt(t)>9?""+parseInt(t):"0"+parseInt(t)},tod:function(t){return t=parseInt(t)>9?""+parseInt(t):"0"+parseInt(t)},getTime:function(t){var e=this,a=e.DateObj().getHours(),n=e.DateObj().getMinutes(),r=e.DateObj().getSeconds(),o="";return"hh:mm"==t?o+=a+":"+n:"hh:mm:ss"==t&&(o+=a+":"+n+":"+r),o},DateObj:function(t){var e;if(t){var a=t.toString().indexOf("-");e="-1"==a?new Date(t):new Date(t.replace(/-/g,"/"))}else e=new Date;return e}},window.Calendar=e}();