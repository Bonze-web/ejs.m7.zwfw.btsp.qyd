!function(){"use strict";function e(){}function t(e){e=mui.extend({},n,e),this.container=this._selector(e.container),this.containerWrapper=this._selector(e.containerWrapper),this.swiper=this._selector(e.swiper),this._initData(e)}var n={swiper:".swiper-container",container:".em-calendar-container",containerWrapper:".em-calendar-wrapper",isLunar:!0,isSwipeH:!0,isSwipeV:!0,swipeCallback:e,pre:".pre",preCallback:e,next:".next",nextCallback:e,itemClick:e,dataRequest:e,isDebug:!1};t.prototype={_initData:function(e){if(this.options=e,!this._validate())throw new Error("验证错误，日历的传入格式非法，请检查代码");this._initParams(),this._addEvent()},_initParams:function(){var e=this;e.nowYear=e.DateObj().getFullYear(),e.nowMonth=e.tod(e.DateObj().getMonth()+1),e.nowDay=e.tod(e.DateObj().getDate()),e.currentDate=e.nowYear+"-"+e.nowMonth+"-"+e.nowDay,e.CalendarData=new Array(100),e.madd=new Array(12),e.tgString="甲乙丙丁戊己庚辛壬癸",e.dzString="子丑寅卯辰巳午未申酉戌亥",e.numString="一二三四五六七八九十",e.monString="正二三四五六七八九十冬腊",e.weekString="日一二三四五六",e.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",e.cYear,e.cMonth,e.cDay,e.TheDate,e.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),e.madd[0]=0,e.madd[1]=31,e.madd[2]=59,e.madd[3]=90,e.madd[4]=120,e.madd[5]=151,e.madd[6]=181,e.madd[7]=212,e.madd[8]=243,e.madd[9]=273,e.madd[10]=304,e.madd[11]=334,this.refreshData(e.nowYear,e.nowMonth,e.nowDay,document.querySelector(".swiper-slide").querySelector(".em-calendar-wrapper"))},refreshData:function(e,t,n,a){var r=this;r.nowYear=parseInt(e),r.nowMonth=r.tom(t),r.nowDay=r.tod(n);var o=new Date(Date.parse(r.nowYear+"/"+r.nowMonth+"/01")),i=o.getDay();i=parseInt(i),0==i&&(i=7);var s=r._judgeDaysByYearMonth(r.nowYear,r.nowMonth);r.dayCount=s;var d={},h=[],c=r._judgeDaysByYearMonth(r.nowYear,parseInt(r.nowMonth-1));c=parseInt(c);for(var u=1;u<i+1;u++){var l=c-i+u,w="day"+u,p="lunar"+u,f=parseInt(r.nowYear),D=parseInt(r.nowMonth);D=-1+D,0==D&&(D=12,f=parseInt(r.nowYear-1)),d[w]=l,d[p]=r._getLunar(l,D,f),h.push({day:l,lunar:r._getLunar(l,D,f),date:f+"-"+r.tom(D)+"-"+r.tod(l),isforbid:"0"})}var y=0;if("28"==s){y=28+i;for(var g=i+1,v=1;g<28+i+1;g++,v++){var w="day"+g,p="lunar"+g;d[w]=v,d[p]=r._getLunar(v),h.push({day:v,lunar:r._getLunar(v),date:r.nowYear+"-"+r.tom(r.nowMonth)+"-"+r.tod(v),isforbid:"1"})}}if("29"==s){y=29+i;for(var g=i+1,v=1;g<29+i+1;g++,v++){var w="day"+g,p="lunar"+g;d[w]=v,d[p]=r._getLunar(v),h.push({day:v,lunar:r._getLunar(v),date:r.nowYear+"-"+r.tom(r.nowMonth)+"-"+r.tod(v),isforbid:"1"})}}if("30"==s){y=30+i;for(var g=i+1,v=1;g<30+i+1;g++,v++){var w="day"+g,p="lunar"+g;d[w]=v,d[p]=r._getLunar(v),h.push({day:v,lunar:r._getLunar(v),date:r.nowYear+"-"+r.tom(r.nowMonth)+"-"+r.tod(v),isforbid:"1"})}}if("31"==s){y=31+i;for(var g=i+1,v=1;g<31+i+1;g++,v++){var w="day"+g,p="lunar"+g;d[w]=v,d[p]=r._getLunar(v),h.push({day:v,lunar:r._getLunar(v),date:r.nowYear+"-"+r.tom(r.nowMonth)+"-"+r.tod(v),isforbid:"1"})}}for(var m=y+1,M=1;m<=42;m++,M++){var w="day"+m,p="lunar"+m,_=parseInt(r.nowYear),b=parseInt(r.nowMonth)+parseInt(1);13==b&&(b=1,_=parseInt(r.nowYear)+parseInt(1)),d[w]=M,d[p]=r._getLunar(M,b,_),h.push({day:M,lunar:r._getLunar(M,b,_),date:_+"-"+r.tom(b)+"-"+r.tod(M),isforbid:"0"})}r.options.isDebug&&console.log("*********日历格式********:\n"+JSON.stringify(h)+"\n"),this._render(d,h,a)},_render:function(e,t,n){var a=this,r=a.nowYear+"-"+a.nowMonth+"-";a.options.dataRequest(r,function(e){var r=e||[];a.options.isDebug&&console.log("*********业务数据：********:\n"+JSON.stringify(r)+"\n");for(var o=0;o<r.length;o++)for(var i=0;i<t.length;i++)r[o].date==t[i].date&&(t[i].isSelected="1");var s="";s+=a.options.weekHeader(),s+=a.options.dayStartNode();for(var i=0,d=t.length;i<d;i++)s+=Mustache.render(a.options.dayTempl(t[i],a.currentDate),t[i]);s+=a.options.dayEndNode(),a.options.isDebug&&console.log("*********日历模板********:\n"+s+"\n"),n.innerHTML=s},a)},uniqueArray:function(e,t){for(var n=[e[0]],a=1;a<e.length;a++){for(var r=e[a],o=!1,i=0;i<n.length;i++)if(r[t]==n[i][t]){o=!0;break}o||n.push(r)}return n},_addEvent:function(){var e=this,t=e.options.itemClick,n=e.options.swipeCallback,a=(e.options.preCallback,e.options.nextCallback,e.options.backToTodayCallback),r=new Swiper(".swiper-container",{loop:!0,cube:{slideShadows:!1,shadow:!1,shadowOffset:10,shadowScale:.6},onSlideNextStart:function(t){var a=t.activeIndex,r=t.slides[a];e.tmpActiveIndex=t.activeIndex,e.tmpSlideNode=t.slides[a],2==a?(e.nowMonth=parseInt(e.nowMonth)+parseInt(1),13==e.nowMonth&&(e.nowYear=e.nowYear+1,e.nowMonth=1),e.nowMonth=e.tom(e.nowMonth),e.nowDay=e.tod(e.nowDay),e.refreshData(e.nowYear,e.nowMonth,e.nowDay,r),n&&n({year:e.nowYear,month:e.nowMonth,day:e.nowDay,dayCount:e.dayCount})):e.refreshData(e.nowYear,e.nowMonth,e.nowDay,document.querySelector(".swiper-slide").querySelector(".em-calendar-wrapper"))},onSlidePrevStart:function(t){var a=t.activeIndex,r=t.slides[a];e.tmpActiveIndex=t.activeIndex,e.tmpSlideNode=t.slides[a],console.log("月份递增"+a),e.nowMonth=parseInt(e.nowMonth)-parseInt(1),0==e.nowMonth&&(e.nowYear=e.nowYear-1,e.nowMonth=12),e.nowMonth=e.tom(e.nowMonth),e.nowDay=e.tod(e.nowDay),e.refreshData(e.nowYear,e.nowMonth,e.nowDay,r),n&&n({year:e.nowYear,month:e.nowMonth,day:e.nowDay,dayCount:e.dayCount})}});r.slideTo(0,1e3,!1),e.swiper=r,mui(".swiper-container").on("tap",".em-calendar-item",function(){if(!this.classList.contains("isforbid0")){Zepto(this).addClass("em-calendar-active").siblings().removeClass("em-calendar-active");var e=this.getAttribute("date");if(this.querySelector(".lunar"))var n=this.querySelector(".lunar").innerText.trim();else var n="已签";t&&t({date:e,lunar:n})}}),e._selector(e.options.pre)&&e._selector(e.options.pre).addEventListener("tap",function(){r.slidePrev()}),e._selector(e.options.next)&&e._selector(e.options.next).addEventListener("tap",function(){r.slideNext()}),e._selector(e.options.backToToday)&&e._selector(e.options.backToToday).addEventListener("tap",function(){var t=e.DateObj().getFullYear(),n=e.tom(e.DateObj().getMonth()+1),r=e.tod(e.DateObj().getDate());e.refresh(),a&&a({year:t,month:n,day:r,date:t+"-"+n+"-"+r})})},refresh:function(){var e=this,t=e.DateObj().getFullYear(),n=e.tom(e.DateObj().getMonth()+1),a=e.tod(e.DateObj().getDate());"1"==e.tmpActiveIndex?e.refreshData(t,n,a,e.swiper.slides[0]):(e.swiper.slideTo(1,1e3,!1),e.refreshData(t,n,a,e.swiper.slides[1]))},_getLunar:function(e,t,n){var a=this,r=n||a.nowYear,o=t||a.nowMonth,i=e;return this._getLunarDay(r,o,i)},_judgeDaysByYearMonth:function(e,t){var n=this;if(void 0==e||null==e)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(void 0==t||null==t)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";var e=parseInt(e),t=parseInt(t);return 0==t&&(e--,t=12),2==t?e%4==0&&e%100!=0||e%400==0?"29":"28":n._inArray(t,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var e=!0;return this.options.container||(e=!1),e},_selector:function(e){return document.querySelector(e)},_inArray:function(e,t){if(!Array.isArray(t))throw"arguments is not Array";for(var n=0,a=t.length;n<a;n++)if(e==t[n])return!0;return!1},_sibling:function(e,t){for(var n=e.parentNode.firstChild;n;n=n.nextSibling)1===n.nodeType&&n!==e&&t&&"function"==typeof t&&t(n)},_getBit:function(e,t){return e>>t&1},_e2c:function(){var e=this;e.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var t,n,a,r,o=!1,i=e.TheDate.getYear();for(i<1900&&(i+=1900),t=365*(i-1921)+Math.floor((i-1921)/4)+e.madd[e.TheDate.getMonth()]+e.TheDate.getDate()-38,e.TheDate.getYear()%4==0&&e.TheDate.getMonth()>1&&t++,n=0;;n++){for(r=e.CalendarData[n]<4095?11:12,a=r;a>=0;a--){if(t<=29+e._getBit(e.CalendarData[n],a)){o=!0;break}t=t-29-e._getBit(e.CalendarData[n],a)}if(o)break}e.cYear=1921+n,e.cMonth=r-a+1,e.cDay=t,12==r&&(e.cMonth==Math.floor(e.CalendarData[n]/65536)+1&&(e.cMonth=1-e.cMonth),e.cMonth>Math.floor(e.CalendarData[n]/65536)+1&&e.cMonth--)},_getcDateString:function(){var e=this,t="";return e.cMonth<1,t+=e.cDay<11?"初":e.cDay<20?"十":e.cDay<30?"廿":"三十",e.cDay%10==0&&10!=e.cDay||(t+=e.numString.charAt((e.cDay-1)%10)),t},_getLunarDay:function(e,t,n){var a=this;return e<1921||e>2080?"":(t=parseInt(t)>0?t-1:11,a._e2c(e,t,n),a._getcDateString())},tom:function(e){return e=parseInt(e)>9?""+parseInt(e):"0"+parseInt(e)},tod:function(e){return e=parseInt(e)>9?""+parseInt(e):"0"+parseInt(e)},getTime:function(e){var t=this,n=t.DateObj().getHours(),a=t.DateObj().getMinutes(),r=t.DateObj().getSeconds(),o="";return"hh:mm"==e?o+=n+":"+a:"hh:mm:ss"==e&&(o+=n+":"+a+":"+r),o},DateObj:function(e){var t;if(e){var n=e.toString().indexOf("-");t="-1"==n?new Date(e):new Date(e.replace(/-/g,"/"))}else t=new Date;return t}},window.Calendar2=t}();