!function(){"use strict";function t(){}function n(t){t=mui.extend({},e,t),this.container=this._selector(t.container),this.containerWrapper=this._selector(t.containerWrapper),this.swiper=this._selector(t.swiper),this._initData(t)}var e={swiper:".swiper-container",container:".em-calendar-container",containerWrapper:".em-calendar-wrapper",isLunar:!0,isSwipeH:!0,isSwipeV:!0,swipeCallback:t,pre:".pre",preCallback:t,next:".next",nextCallback:t,itemClick:t,data:[],isDebug:!1};n.prototype={_initData:function(t){if(this.options=t,!this._validate())throw new Error("验证错误，日历的传入格式非法，请检查代码");this._initParams(),this._addEvent()},_initParams:function(){var t=this;t.newDate=new Date,t.nowYear=t.newDate.getFullYear(),t.nowMonth=t.newDate.getMonth()+1,t.nowDay=t.newDate.getDate();var n=new Date,e=n.getMonth()+1,a=n.getDate();t.currentDate=n.getFullYear()+"-"+t.tom(e)+"-"+t.tod(a),t.nowMonth=String(t.nowMonth),1==t.nowMonth.length&&(t.nowMonth="0"+t.nowMonth),t.CalendarData=new Array(100),t.madd=new Array(12),t.tgString="甲乙丙丁戊己庚辛壬癸",t.dzString="子丑寅卯辰巳午未申酉戌亥",t.numString="一二三四五六七八九十",t.monString="正二三四五六七八九十冬腊",t.weekString="日一二三四五六",t.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",t.cYear,t.cMonth,t.cDay,t.TheDate,t.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),t.madd[0]=0,t.madd[1]=31,t.madd[2]=59,t.madd[3]=90,t.madd[4]=120,t.madd[5]=151,t.madd[6]=181,t.madd[7]=212,t.madd[8]=243,t.madd[9]=273,t.madd[10]=304,t.madd[11]=334,this.refresh(t.nowYear,t.nowMonth,t.nowDay,document.querySelector(".swiper-slide").querySelector(".em-calendar-wrapper"))},refresh:function(t,n,e,a){var o=this;o.nowYear=parseInt(t),o.nowMonth=parseInt(n),o.nowDay=parseInt(e),o.nowMonth=o.tom(o.nowMonth),o.nowDay=o.tod(o.nowDay);var r=new Date(Date.parse(o.nowYear+"/"+o.nowMonth+"/01")),i=r.getDay();i=parseInt(i),0==i&&(i=7);var s=o._judgeDaysByYearMonth(o.nowYear,o.nowMonth);o.dayCount=s;var d={},h=[],c=o._judgeDaysByYearMonth(o.nowYear,o.nowMonth-1);c=parseInt(c);for(var l=1;l<i+1;l++){var u=c-i+l,w="day"+l,p="lunar"+l;d[w]=u,d[p]=o._getLunar(u,"m-1"),h.push({day:u,lunar:o._getLunar(u,"m-1"),date:o.nowYear+"-"+o.tom(o.nowMonth-1)+"-"+o.tod(u),isforbid:"0"})}var y=0;if("28"==s){y=28+i;for(var f=i+1,g=1;f<28+i+1;f++,g++){var w="day"+f,p="lunar"+f;d[w]=g,d[p]=o._getLunar(g),h.push({day:g,lunar:o._getLunar(g),date:o.nowYear+"-"+o.tom(o.nowMonth)+"-"+o.tod(g),isforbid:"1"})}}if("29"==s){y=29+i;for(var f=i+1,g=1;f<29+i+1;f++,g++){var w="day"+f,p="lunar"+f;d[w]=g,d[p]=o._getLunar(g),h.push({day:g,lunar:o._getLunar(g),date:o.nowYear+"-"+o.tom(o.nowMonth)+"-"+o.tod(g),isforbid:"1"})}}if("30"==s){y=30+i;for(var f=i+1,g=1;f<30+i+1;f++,g++){var w="day"+f,p="lunar"+f;d[w]=g,d[p]=o._getLunar(g),h.push({day:g,lunar:o._getLunar(g),date:o.nowYear+"-"+o.tom(o.nowMonth)+"-"+o.tod(g),isforbid:"1"})}}if("31"==s){y=31+i;for(var f=i+1,g=1;f<31+i+1;f++,g++){var w="day"+f,p="lunar"+f;d[w]=g,d[p]=o._getLunar(g),h.push({day:g,lunar:o._getLunar(g),date:o.nowYear+"-"+o.tom(o.nowMonth)+"-"+o.tod(g),isforbid:"1"})}}for(var D=y+1,m=1;D<=42;D++,m++){var w="day"+D,p="lunar"+D;d[w]=m,d[p]=o._getLunar(m,"m+1"),h.push({day:m,lunar:o._getLunar(m,"m+1"),date:o.nowYear+"-"+o.tom(parseInt(o.nowMonth)+parseInt(1))+"-"+o.tod(m),isforbid:"0"})}o.options.isDebug&&console.log("*********日历格式********:\n"+JSON.stringify(h)+"\n"),this._render(d,h,a)},_render:function(t,n,e){var a=this;a.options.isDebug&&console.log("*********业务数据：********:\n"+JSON.stringify(a.options.data)+"\n");for(var o=0;o<a.options.data.length;o++)for(var r=0;r<n.length;r++)a.options.data[o].date==n[r].date&&(n[r].isSelected="1");var i="";i+=a.options.weekHeader(),i+=a.options.dayStartNode();for(var r=0,s=n.length;r<s;r++)i+=Mustache.render(a.options.dayTempl(n[r],a.currentDate),n[r]);i+=a.options.dayEndNode(),a.options.isDebug&&console.log("*********日历模板********:\n"+i+"\n"),e.innerHTML=i},_addEvent:function(){var t=this,n=t.options.itemClick,e=t.options.swipeCallback,a=(t.options.preCallback,t.options.nextCallback,t.options.backToTodayCallback),o=new Swiper(".swiper-container",{loop:!0,effect:"cube",cube:{slideShadows:!1,shadow:!1,shadowOffset:10,shadowScale:.6},onSlideNextStart:function(n){var a=n.activeIndex,o=n.slides[a];t.tmpActiveIndex=n.activeIndex,t.tmpSlideNode=n.slides[a],console.log("月份递减"+a),2==a&&(t.nowMonth=parseInt(t.nowMonth)+parseInt(1),13==t.nowMonth&&(t.nowYear=t.nowYear+1,t.nowMonth=1),t.nowMonth=t.tom(t.nowMonth),t.nowDay=t.tod(t.nowDay),t.refresh(t.nowYear,t.nowMonth,t.nowDay,o),e&&e({year:t.nowYear,month:t.nowMonth,day:t.nowDay,dayCount:t.dayCount}))},onSlidePrevStart:function(n){var a=n.activeIndex,o=n.slides[a];t.tmpActiveIndex=n.activeIndex,t.tmpSlideNode=n.slides[a],console.log("月份递增"+a),t.nowMonth=parseInt(t.nowMonth)-parseInt(1),0==t.nowMonth&&(t.nowYear=t.nowYear-1,t.nowMonth=12),t.nowMonth=t.tom(t.nowMonth),t.nowDay=t.tod(t.nowDay),t.refresh(t.nowYear,t.nowMonth,t.nowDay,o),e&&e({year:t.nowYear,month:t.nowMonth,day:t.nowDay,dayCount:t.dayCount})}});o.slideTo(0,1e3,!1),mui(".swiper-container").on("tap",".em-calendar-item",function(){if(!this.classList.contains("isforbid0")){Zepto(this).addClass("em-calendar-active").siblings().removeClass("em-calendar-active");var t=this.getAttribute("date");if(this.querySelector(".lunar"))var e=this.querySelector(".lunar").innerText.trim();else var e="已签";n&&n({date:t,lunar:e})}}),t._selector(t.options.pre)&&t._selector(t.options.pre).addEventListener("tap",function(){o.slidePrev()}),t._selector(t.options.next)&&t._selector(t.options.next).addEventListener("tap",function(){o.slideNext()}),t._selector(t.options.backToToday)&&t._selector(t.options.backToToday).addEventListener("tap",function(){var n=new Date,e=n.getFullYear(),r=t.tom(n.getMonth()+1),i=t.tod(n.getDate());t.refresh(e,r,i,t.tmpSlideNode),"1"==t.tmpActiveIndex||o.slideTo(1,1e3,!1),a&&a({year:e,month:r,day:i,date:e+"-"+r+"-"+i})})},_getLunar:function(t,n){var e=this,a=e.nowYear,o=e.nowMonth;o=parseInt(o),"m+1"===n&&(o=1+o,13==o&&(o=1)),"m-1"===n&&(o=-1+o,0==o&&(o=1));var r=t;new Date(Date.parse(a+"/"+o+"/"+r)).getDay();return this._getLunarDay(a,o,r)},_judgeDaysByYearMonth:function(t,n){var e=this;if(void 0==t||null==t)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(void 0==n||null==n)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";var t=parseInt(t),n=parseInt(n);return 0==n&&(t--,n=12),2==n?t%4==0&&t%100!=0||t%400==0?"29":"28":e._inArray(n,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var t=!0;return this.options.container||(t=!1),t},_selector:function(t){return document.querySelector(t)},_inArray:function(t,n){if(!Array.isArray(n))throw"arguments is not Array";for(var e=0,a=n.length;e<a;e++)if(t==n[e])return!0;return!1},_sibling:function(t,n){for(var e=t.parentNode.firstChild;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n&&"function"==typeof n&&n(e)},_getBit:function(t,n){return t>>n&1},_e2c:function(){var t=this;t.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var n,e,a,o,r=!1,i=t.TheDate.getYear();for(i<1900&&(i+=1900),n=365*(i-1921)+Math.floor((i-1921)/4)+t.madd[t.TheDate.getMonth()]+t.TheDate.getDate()-38,t.TheDate.getYear()%4==0&&t.TheDate.getMonth()>1&&n++,e=0;;e++){for(o=t.CalendarData[e]<4095?11:12,a=o;a>=0;a--){if(n<=29+t._getBit(t.CalendarData[e],a)){r=!0;break}n=n-29-t._getBit(t.CalendarData[e],a)}if(r)break}t.cYear=1921+e,t.cMonth=o-a+1,t.cDay=n,12==o&&(t.cMonth==Math.floor(t.CalendarData[e]/65536)+1&&(t.cMonth=1-t.cMonth),t.cMonth>Math.floor(t.CalendarData[e]/65536)+1&&t.cMonth--)},_getcDateString:function(){var t=this,n="";return t.cMonth<1,n+=t.cDay<11?"初":t.cDay<20?"十":t.cDay<30?"廿":"三十",t.cDay%10==0&&10!=t.cDay||(n+=t.numString.charAt((t.cDay-1)%10)),n},_getLunarDay:function(t,n,e){var a=this;return t<1921||t>2080?"":(n=parseInt(n)>0?n-1:11,a._e2c(t,n,e),a._getcDateString())},tom:function(t){return t=parseInt(t)>9?""+parseInt(t):"0"+parseInt(t)},tod:function(t){return t=parseInt(t)>9?""+parseInt(t):"0"+parseInt(t)},getTime:function(t){var n=new Date,e=n.getHours(),a=n.getMinutes(),o=n.getSeconds(),r="";return"hh:mm"==t?r+=e+":"+a:"hh:mm:ss"==t&&(r+=e+":"+a+":"+o),r}},window.Calendar2=n}();